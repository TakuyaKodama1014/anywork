# チームのつながりを Infrastructure as Code でデザインする

## ソフトウェア開発におけるチームのつながり

ソフトウェアでビジネス価値を提供する

ビジネス価値はユーザーの課題解決の対価
顧客体験が悪いソフトウェアは使われない

魅⼒的なソフトウェアはどうやって作るか︖


魅⼒品質、顧客体験の良さを計画して作り込むことはできない
• 独⾃機能は競合が真似したら当たり前に
• ソフトウェアの周辺環境は絶えず変化
• ユーザーの社会的状況やニーズが多様化
　　　↓
ユーザーの⾏動観察やフィードバックに基づいて継続的に改善を⾏う必要がある

イノベーションの⽅法論 - The Lean Startup

不確実性の⾼い状況の中で
ビジネスを⽴ち上げ
成⻑させていく⽅法論

最も価値のある最⼩限の事業やプロダクト* をリリースし、
ユーザの反応を検証して改善・軌道修正を⾏う
ループをいかに早く回すかが重要

ソフトウェアの変更フローに沿ったチーム

チームのつながりが不適切だとフローが低下する

専⾨家による役割分担は不確実性が⾼いと⾮効率

ウォーターフォール開発ではリソース効率を重視
• ⼯程ごとにリソース量を制御しやすい
• 計画通りにモノを作るのに適する
• 市場の変化や技術の進化に対するリスクが⼤きい


アジャイル開発ではフロー効率を重視
• 変化への対応を⾏いやすい
• 探索的・継続的にサービスを作るのに適する
• ⾼度な⼈材を⻑期間アサインしつづける
必要があり、チームへの適切な⽀援も必要


フロー効率の向上は開発者だけの問題ではない
Dev、Biz、Ops
チームのつながりに影響を与える技術やプラクティスには、周囲の理解と協⼒が必要

フロー効率を⾼めるには組織⽂化の変⾰が必要



組織⽂化を変えていく上でまず最初にやるべきなのは、
関係者の思考⽅法を変えることではなく、
関係者の⾔動、つまり皆が何をどう⾏うかを変えることだ


⼈を⼀箇所に集めただけでは俊敏なチームは作れない。
メカニズムが必要

Infrastructure as Code はチームのコラボレーションの中⼼になる


## IaC でチーム作りの5 つの障壁を乗り越える


Infrastructure as Code を DevOps の第⼀歩にする

IaC は DevOps の
技術的プラクティスの⼟台


- 継続的デリバリー
- セキュリティのシフトレフト
- CI/CD
- Observability
- テストの⾃動化
- クラウドの柔軟性
- コードの保守性
- Infrastructure as Code (IaC)


- IIaC を中⼼としてチームがコラボレーションする

- Git リポジトリ
    - インフラストラクチャ
    - アプリケーション
    - CI/CD パイプライン
    - 設定と Observability


IaC はチームのインタラクションを改善するプラクティスのひとつ


## 障壁１　⼿動構築による環境のブラックボックス化

• 変更が積み重なると現在の状態がわからなくなる
• 条件分岐やロールバック操作の網羅は困難
• 操作ミスの可能性が排除できず環境の⼀貫性を担保できない

## 解決策1 IaC で環境の⼀貫性を担保する 

• コードを⾒れば現在の状態が⼀⽬瞭然
• 操作ミスの可能性がなく、素早く複製できる
• リソースの作成順序の解決やロールバックはAWS CloudFormation に任せられる

## 本当は難しい『⼿順書』
• ⼿順書を読んで状態を理解するには脳内で操作のシミュレートが必要
• ミスの排除と複雑なエラー処理、条件分岐が必要なため⼿順と作業の完全⼀致はほぼ不可能
• ⼿順書やパラメータシートが⾃然⾔語で書かれている必要性はない

IaC のコードはシンプルで正確なドキュメントでもある


## プログラミング⾔語の表現⼒が意図を明確にする
• AWS CDK は grantRead などの抽象化されたメソッドで意図が伝わりやすい
• 複雑な IAM ポリシーを書かずに最⼩権限化
• AWS Well-Architected FrameworkDevOps Guidance でも推奨されている


## 障壁2 アプリの状態と変更理由を追跡できない
• ドキュメントやコードの所在がわからない
• 正確な状態がわからず実際の環境を確認する必要がある
• バージョン管理されておらず変更が追跡できない

## 解決策2 CDK でアプリ全体をコードで定義する
•「Git リポジトリを⾒ればわかる」状態は認知負荷を軽減する
• 他のチームからの学びや新規メンバーの参⼊、引き継ぎが容易に
• 変更理由や判断の経緯を追跡して過ちを防ぐ

## 障壁3 役割の壁が⾏動の選択肢を制限している
• ⾃分のタスクだけに集中し Ownership が低下
• 運⽤のしやすさ、セキュリティ、コストなどチームや⼯程をまたぐ改善ができない
• クラウドネイティブなアーキテクチャではアプリとインフラは分けられない
• 新しいサービスやアーキテクチャが活⽤されない

## 解決策3 CDK を共通⾔語としてチーム全員で扱う

• チームとしてすべての能⼒をカバーする
• 職能ごとに担当領域を限定しない
• セキュリティやデプロイの安全性、Observability を組み込む

## 障壁4 スキルの拡張・転換が進まない
⼼理的な壁は、⾃分の領域から少しはみ出した有⽤な技術の習得を阻む
探索的なアプローチでは、幅広い技術を統合することが必要

## 解決策4 CDK をスキル転換の第⼀歩にする

• AWS CDK はプログラミング⾔語で記述するが、複雑なロジックは不要
• チームメンバーのタスクの透明性がコラボレーションを促進する

## 解決策4 協働のためのベース知識を⾝につける

## 障壁5 クラウドなのに環境構築に数週間かかる
• チームがセルフサービスでクラウドを使えない
• サイロ化した組織では多くの待ちが発⽣する
• 組織のガバナンスが単⼀のチームや⼿動承認に依存している

## 解決策5 CDK で安全なセルフサービスを実現する
• IaC でコード化されることにより追加のセキュリティレイヤー と透明性のある変更管理が利⽤可能になる
• CI/CD パイプラインから⾃動デプロイすることで⼈をデータから遠ざける


## IaC でチーム作りの 5 つの障壁を乗り越える


ソフトウェアで継続的に顧客に価値を届ける
変更を素早く提供しフィードバックループを回す
End-to-end で責任をもつチーム

- 環境の⼀貫性と⾃動化
- すべてをコード化
- チームの共通⾔語
- 役割を越えて探索する
- 安全なセルフサービスを構築


ひとつのチームですべてを⾏うのは困難。
チームを⽀援するメカニズムが必要

IaC はチーム間のインターフェイスになる


## IaC でチーム間のインタラクションをデザインする

ストリームアラインドチーム
ビジネスの流れに沿ったチーム

チーム作りの次のステップ︓チームのサイズ、寿命、関係、認知をデザインする

チームとは︓ Two-Pizza Teams

- ９ 名以下の⾃律的に動ける⼩さなチーム
- プロダクトを所有しすべての説明責任と権限を持つ


## チーム設計はビジネス価値に強い影響を与える


### コンウェイの法則
システムのアーキテクチャは、組織構造やチーム間の実際のコミュニケーションを反映したものになる

### 逆コンウェイ戦略
理想的なアーキテクチャを実現したいなら、アーキテクチャに沿ったチーム構成をとればいい


## ストリームアラインドチームを協⼒会社とつくる
チームに⾃律性と権限委譲が必要なため、協働が不可⽋


## チームの認知負荷とコミュニケーションを制約する

チームの最⼤⼈数 = 認知負荷の合計には上限がある。
ものごとをチームの規模にとどめておくための戦略が必要

- Infrastructure as Code による抽象化・⾃動化
- プラットフォームや再利⽤可能な部品の利⽤
- マイクロサービスによる関⼼の分離
- 研修やペアプログラミングによる能⼒の獲得

## チームトポロジーによる整理

4 つのチームタイプ
- ストリームアラインドチーム
    - イネイブリングチーム
    - コンプリケイテッド・サブシステムチーム
    - プラットフォームチーム
ストリームアラインドチームを他のチームが支援する

3 つのインタラクションモード
- コラボレーション
- X as a Service
- ファシリテーション

## プラットフォームは「共通基盤」ではない

• ストリームアラインドチームを⽀援するために他のチームが内部サービスを提供する
• Platform as a Product
    • エンジニアを顧客としてプラットフォームの価値を測定し、説明する
    • ストリームアラインドチームはプラットフォームを使わない選択が可能
    • いくつかの成功したストリームアラインドチームがあって初めて必要なものがわかる

## 常に、最⼩限のプラットフォームを⽬指す
いちばんシンプルなプラットフォームは、下位のコンポーネントやサービスについて書いた単なる Wiki ページ上のリストだ。

セキュリティや業界固有の要件を実装したAWS CDK のサンプルコードも
薄いプラットフォームの⼀例

CDK Construct としてモジュール化し構成パターンやアーキテクチャを組織で共有


## IaC コードからプラットフォームに発展させる
- 分散型のプラットフォーム
    - ドキュメントやサンプルコード、モジュール、AWS CDK コンストラクトなどを公開
    - ストリームアラインドチームが運⽤責任を負うが、⾃由にカスタマイズ可能
    - 始めやすく、有⽤なパターンの探索にも有効
- 中央集権型のプラットフォーム
    - 独⾃のインフラやサービスを構築し、プラットフォームチームが運⽤する
    - ストリームアラインドチームはプラットフォームの裏側を知らずに済む
    - 適切な境界の設定や API 設計のために⾼度な技術とプロダクトマネジメントが必要

## Baseline Environment on AWS (BLEA)
- セキュリティベースラインをコードで提供
    - AWS のセキュリティサービスを活⽤して軽量なガバナンスベースを提供
    - AWS のセキュリティベストプラクティスを満たす Web アプリなどのサンプルコードを提供
- スケーラブルなガバナンス運⽤モデル
    - 権限委譲と分散管理を実現するためにセキュリティ通知や CI/CD のサンプル実装を提供
    - AWS CDK コードによる薄いプラットフォームの実例


まとめ

チームのつながりをデザインする
インタラクションを適正にするメカニズムをつくる

## IaC とチームトポロジーを戦略的に利⽤する
- AWS CDK ですべてをコード化しチームの障壁を取り除く
- アーキテクチャとチームの形を⼀致させる
- ストリームアラインドチームの認知負荷を減らす


